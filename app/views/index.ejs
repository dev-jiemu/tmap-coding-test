<!doctype html>
<html lang="ko" class="overflow-hidden">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>TmapCodingTest</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css"/>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <script src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=<%= tmapKey %>"></script>
    <script src="/getScript"></script>
</head>

<body class="overflow-hidden">

<!-- map, list , root -->
<section class="relative h-dvh w-dvh bg-black/20">
    <div class="size-full object-cover" id="map_div"></div>
</section>

<script>
    // TMAP 초기화 함수
    function initTmap() {
        console.log('Initializing TMAP...');
        
        try {
            var map = new Tmapv2.Map("map_div", {
                center: new Tmapv2.LatLng(37.566481622437934, 126.98502302169841),
                width: "100%", 
                height: "100%",
                zoom: 15
            });
            
            window.tmapInstance = map;
            window.tmapInitialized = true;
            window.tmapMarkers = [];
            
            console.log('TMAP initialized successfully!');
            
        } catch (error) {
            console.error('TMAP initialization failed:', error);
        }
    }
    
    // TMAP 마커 추가 함수
    function addTmapMarker(poi) {
        if (!window.tmapInitialized || !window.tmapInstance) {
            console.log('TMAP not ready, skipping marker:', poi.title);
            return;
        }
        
        try {
            var marker = new Tmapv2.Marker({
                position: new Tmapv2.LatLng(poi.latitude, poi.longitude),
                icon: "/images/pin-location.svg",
                iconSize: new Tmapv2.Size(24, 38),
                title: poi.title,
                map: window.tmapInstance
            });
            
            marker.addListener("click", function() {
                alert("POI: " + poi.title);
            });
            
            if (!window.tmapMarkers) window.tmapMarkers = [];
            window.tmapMarkers.push(marker);
            
            console.log('Marker added:', poi.title);
            
        } catch (error) {
            console.error('Failed to add marker:', poi.title, error);
        }
    }

    // 페이지 로드 후 TMAP 초기화
    document.addEventListener('DOMContentLoaded', function() {
        // TMAP 라이브러리 로드 대기
        setTimeout(function() {
            initTmap();
            
            // TMAP 초기화 완료 후 POI 로드
            setTimeout(function() {
                if (typeof loadPOIMarkers === 'function') {
                    console.log('Loading POI markers after TMAP initialization...');
                    loadPOIMarkers();
                }
            }, 500);
            
        }, 1000);
    });
</script>
<!-- TODO : refresh button fix -->
<div class="fixed top-0">
    <div class="p-1 bg-white flex items-center gap-2">
        <label class="input w-full">
            <input type="search" required placeholder="Search"/>
        </label>

        <button type="button" class="flex-none size-10 cursor-pointer">
            <svg class="w-full h-[2rem] opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <g
                        stroke-linejoin="round"
                        stroke-linecap="round"
                        stroke-width="2.5"
                        fill="none"
                        stroke="currentColor"
                >
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.3-4.3"></path>
                </g>
            </svg>
        </button>
    </div>
</div>
<div
        class="fixed bottom-10 left-10 z-[5] grid grid-rows-2 gap-10 peer-aria-[hidden=false]:bottom-[58dvh]"
        data-location="box"
        id="btnBox"
>
    <button
            type="button"
            class="grid size-15 place-content-center rounded-full border border-[#ccc] bg-[#fff] shadow-md"
            aria-label="refresh"
            title="refresh"
    >
        <span>refresh</span>
    </button>
    <input type="file" id="excelFileInput" accept=".xlsx,.xls" style="display: none;">
    <button
            type="button"
            class="grid size-15 place-content-center rounded-full border border-[#ccc] bg-[#fff] shadow-md"
            aria-label="import"
            title="import"
            onclick="document.getElementById('excelFileInput').click()"
    >
        <span>import</span>
    </button>
</div>

</body>

</html>